require(methods)
if (exists("test.data.table", .GlobalEnv, inherits=FALSE)) {
  if ((tt<-compiler::enableJIT(-1))>0)
    cat("This is dev mode and JIT is enabled (level ", tt, ") so there will be a brief pause around the first test.\n", sep="")
} else {
  require(data.table)
  test = data.table:::test
  fwhich = data.table:::fwhich
}

sugg = c(
  "bit64",
  "nanotime"
)
for (s in sugg) {
  assign(paste0("test_",s), loaded<-suppressWarnings(suppressMessages(require(s, character.only=TRUE))))
  if (!loaded) cat("\n**** Suggested package",s,"is not installed. Tests using it will be skipped.\n\n")
}

options(datatable.auto.index=FALSE)

set.seed(108)
wh = function(x) eval(substitute(identical(which(.x, useNames=FALSE), fwhich(.x)), list(.x=substitute(x))), parent.frame())
options(datatable.verbose=FALSE)
N = 1e6L
x = sample.int(3L, N, TRUE)
y = sample.int(3L, N, TRUE)
z = sample.int(3L, N, TRUE)
test(1, wh(x==1L & y==2L & z==3L))
